<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>線上退費服務中心</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        .signature-canvas {
            touch-action: none;
            cursor: crosshair;
        }
        /* Hide scrollbar for clean modal */
        .no-scroll {
            overflow: hidden;
        }
        .app-container {
            max-width: 480px; /* Mobile width simulation */
            margin: 0 auto;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
            position: relative;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Mock Data ---
        const USER_DATA = {
            name: "王*明",
            phone: "09**-***-228",
            id: "A12****789",
            refundAmount: "NT$ 5,800",
            caseId: "RF-20231024-0089"
        };

        // --- Icons Component Wrapper ---
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} width={size} height={size} className={className}></i>;
        };

        // --- View 1: SMS Simulation ---
        const SMSView = ({ onLinkClick }) => {
            return (
                <div className="app-container bg-gray-900 text-white flex flex-col">
                    <div className="p-4 border-b border-gray-800 flex items-center gap-3">
                        <div className="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center text-xs">
                            <Icon name="user" size={16} />
                        </div>
                        <div>
                            <div className="font-bold text-sm">客服中心</div>
                            <div className="text-xs text-gray-400">剛剛</div>
                        </div>
                    </div>
                    <div className="flex-1 p-4 space-y-4">
                        <div className="text-center text-xs text-gray-500 mb-4">今天 下午 2:30</div>
                        
                        {/* Message Bubble */}
                        <div className="flex flex-col items-start max-w-[85%]">
                            <div className="bg-gray-800 rounded-2xl rounded-tl-none p-4 text-sm leading-relaxed shadow-sm">
                                <p className="mb-2">【退費通知】親愛的用戶您好，您的服務終止申請已核准。</p>
                                <p className="mb-2">退費金額：<span className="text-yellow-400 font-bold">{USER_DATA.refundAmount}</span></p>
                                <p className="mb-3">請點擊下方連結完成身分驗證與帳戶綁定以進行撥款：</p>
                                <button 
                                    onClick={onLinkClick}
                                    className="block w-full text-center bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg font-medium transition-colors"
                                >
                                    https://service.refund/verify
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Components for Form ---
        const UploadCard = ({ title, desc, isDone, onClick }) => (
            <div 
                onClick={onClick}
                className={`border-2 border-dashed rounded-xl p-4 flex flex-col items-center justify-center text-center cursor-pointer transition-all ${isDone ? 'border-green-500 bg-green-50' : 'border-gray-300 hover:border-blue-400 bg-gray-50'}`}
            >
                {isDone ? (
                    <div className="text-green-600 flex flex-col items-center">
                        <Icon name="check-circle" size={32} className="mb-2" />
                        <span className="text-sm font-bold">已上傳</span>
                    </div>
                ) : (
                    <div className="text-gray-400 flex flex-col items-center">
                        <Icon name="camera" size={32} className="mb-2" />
                        <span className="text-gray-700 font-medium text-sm">{title}</span>
                        <span className="text-xs text-gray-400 mt-1">{desc}</span>
                    </div>
                )}
            </div>
        );

        const SignaturePad = ({ onClose, onSave }) => {
            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);
            const [hasDrawn, setHasDrawn] = useState(false);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                // Set canvas size
                const updateSize = () => {
                    if (canvas && canvas.parentElement) {
                        const rect = canvas.parentElement.getBoundingClientRect();
                        canvas.width = rect.width;
                        canvas.height = rect.height;
                        ctx.strokeStyle = "#000";
                        ctx.lineWidth = 3;
                        ctx.lineCap = "round";
                    }
                };
                
                updateSize();
                // window.addEventListener('resize', updateSize);
                // return () => window.removeEventListener('resize', updateSize);
            }, []);

            const getPos = (e) => {
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const clientX = e.clientX || (e.touches && e.touches[0] ? e.touches[0].clientX : 0);
                const clientY = e.clientY || (e.touches && e.touches[0] ? e.touches[0].clientY : 0);
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            };

            const startDrawing = (e) => {
                // e.preventDefault(); // Prevent scrolling on touch
                const { x, y } = getPos(e);
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                setIsDrawing(true);
                setHasDrawn(true);
                ctx.beginPath();
                ctx.moveTo(x, y);
            };

            const draw = (e) => {
                // e.preventDefault();
                if (!isDrawing) return;
                const { x, y } = getPos(e);
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            const stopDrawing = () => {
                setIsDrawing(false);
            };

            const handleSave = () => {
                if (!hasDrawn) return;
                const canvas = canvasRef.current;
                onSave(canvas.toDataURL());
                onClose();
            };

            return (
                <div className="fixed inset-0 z-50 bg-black/50 flex items-end sm:items-center justify-center animate-fade-in">
                    <div className="bg-white w-full max-w-md sm:rounded-xl rounded-t-2xl p-4 flex flex-col h-[80vh] sm:h-[500px]">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="font-bold text-lg">請在下方簽名</h3>
                            <button onClick={onClose} className="p-2 text-gray-500"><Icon name="x" /></button>
                        </div>
                        <div className="flex-1 bg-gray-100 border rounded-xl overflow-hidden touch-none relative">
                             <canvas 
                                ref={canvasRef}
                                className="w-full h-full signature-canvas"
                                onMouseDown={startDrawing}
                                onMouseMove={draw}
                                onMouseUp={stopDrawing}
                                onMouseLeave={stopDrawing}
                                onTouchStart={startDrawing}
                                onTouchMove={draw}
                                onTouchEnd={stopDrawing}
                            />
                            {!hasDrawn && <div className="absolute inset-0 flex items-center justify-center text-gray-300 pointer-events-none text-2xl">簽署區域</div>}
                        </div>
                        <div className="mt-4 flex gap-3">
                            <button onClick={() => {
                                const canvas = canvasRef.current;
                                const ctx = canvas.getContext('2d');
                                ctx.clearRect(0, 0, canvas.width, canvas.height);
                                setHasDrawn(false);
                            }} className="flex-1 py-3 text-gray-600 font-medium">清除</button>
                            <button 
                                onClick={handleSave}
                                disabled={!hasDrawn}
                                className={`flex-1 py-3 rounded-lg font-bold text-white transition-colors ${hasDrawn ? 'bg-blue-600 hover:bg-blue-700' : 'bg-gray-300'}`}
                            >
                                確認簽名
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- View 2: Refund Form ---
        const RefundFormView = ({ onSubmit }) => {
            const [showSignaturePad, setShowSignaturePad] = useState(false);
            const [signature, setSignature] = useState(null);
            const [uploads, setUploads] = useState({ idFront: false, idBack: false, bankBook: false });
            const [isSubmitting, setIsSubmitting] = useState(false);

            const handleUpload = (key) => {
                // Simulate upload delay
                setTimeout(() => {
                    setUploads(prev => ({ ...prev, [key]: true }));
                }, 800);
            };

            const canSubmit = signature && uploads.idFront && uploads.idBack && uploads.bankBook;

            const handleSubmit = () => {
                if (!canSubmit) return;
                setIsSubmitting(true);
                // Simulate API call
                setTimeout(() => {
                    onSubmit();
                }, 1500);
            };

            return (
                <div className="app-container bg-gray-50 flex flex-col min-h-screen relative pb-24">
                    {/* Header */}
                    <header className="bg-white px-4 py-4 shadow-sm sticky top-0 z-10 flex items-center justify-between">
                        <div className="font-bold text-lg text-gray-800">退費申請中心</div>
                        <div className="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">SSL 加密保護</div>
                    </header>

                    <div className="p-4 space-y-6 flex-1 overflow-y-auto">
                        
                        {/* Notice */}
                        <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r shadow-sm">
                            <p className="text-sm text-blue-800">請確認以下資料並完成身分驗證，以利款項順利匯入。</p>
                        </div>

                        {/* Masked Data Card */}
                        <div className="bg-white rounded-xl p-5 shadow-sm space-y-3 border border-gray-100">
                            <h3 className="text-gray-500 text-xs font-bold uppercase tracking-wider mb-2">基本資料核對</h3>
                            <div className="flex justify-between border-b border-gray-100 pb-2">
                                <span className="text-gray-500">案件編號</span>
                                <span className="font-mono text-gray-800">{USER_DATA.caseId}</span>
                            </div>
                            <div className="flex justify-between border-b border-gray-100 pb-2">
                                <span className="text-gray-500">姓名</span>
                                <span className="font-medium text-gray-800">{USER_DATA.name}</span>
                            </div>
                            <div className="flex justify-between border-b border-gray-100 pb-2">
                                <span className="text-gray-500">聯絡電話</span>
                                <span className="font-mono text-gray-800">{USER_DATA.phone}</span>
                            </div>
                            <div className="flex justify-between border-b border-gray-100 pb-2">
                                <span className="text-gray-500">身分證字號</span>
                                <span className="font-mono text-gray-800">{USER_DATA.id}</span>
                            </div>
                            <div className="flex justify-between pt-1">
                                <span className="text-gray-500">退費金額</span>
                                <span className="font-bold text-xl text-blue-600">{USER_DATA.refundAmount}</span>
                            </div>
                        </div>

                        {/* Upload Section */}
                        <div className="space-y-3">
                            <h3 className="font-bold text-gray-800 flex items-center gap-2">
                                <Icon name="file-text" size={18} className="text-blue-600" />
                                證件上傳
                            </h3>
                            <div className="grid grid-cols-2 gap-3">
                                <UploadCard 
                                    title="身分證正面" 
                                    desc="請拍攝正面" 
                                    isDone={uploads.idFront} 
                                    onClick={() => handleUpload('idFront')}
                                />
                                <UploadCard 
                                    title="身分證反面" 
                                    desc="請拍攝反面" 
                                    isDone={uploads.idBack} 
                                    onClick={() => handleUpload('idBack')}
                                />
                            </div>
                            <UploadCard 
                                title="存摺封面" 
                                desc="需含帳號與戶名" 
                                isDone={uploads.bankBook} 
                                onClick={() => handleUpload('bankBook')}
                            />
                        </div>

                         {/* Signature Section Display */}
                         <div className="space-y-2">
                            <h3 className="font-bold text-gray-800 flex items-center gap-2">
                                <Icon name="pen-tool" size={18} className="text-blue-600" />
                                用戶簽署
                            </h3>
                            <div className="bg-white border rounded-xl h-24 flex items-center justify-center overflow-hidden relative">
                                {signature ? (
                                    <img src={signature} alt="Signed" className="max-h-full" />
                                ) : (
                                    <span className="text-gray-400 text-sm">尚未簽名</span>
                                )}
                            </div>
                        </div>

                        {/* Spacer for floating button */}
                        <div className="h-20"></div>
                    </div>

                    {/* Floating Signature Button (Bottom Right) */}
                    {!signature && (
                        <button 
                            onClick={() => setShowSignaturePad(true)}
                            className="absolute bottom-24 right-4 bg-blue-600 text-white p-4 rounded-full shadow-lg shadow-blue-600/30 flex items-center gap-2 animate-bounce hover:bg-blue-700 transition-colors z-20"
                        >
                            <Icon name="pen-tool" size={24} />
                            <span className="font-bold pr-1">點此簽名</span>
                        </button>
                    )}

                    {/* Submit Bar */}
                    <div className="absolute bottom-0 left-0 right-0 bg-white p-4 border-t shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] z-20">
                        <button 
                            onClick={handleSubmit}
                            disabled={!canSubmit || isSubmitting}
                            className={`w-full py-3.5 rounded-xl font-bold text-lg flex items-center justify-center gap-2
                                ${canSubmit && !isSubmitting ? 'bg-green-600 text-white hover:bg-green-700 shadow-green-200 shadow-lg' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}
                            `}
                        >
                            {isSubmitting ? (
                                <>
                                    <Icon name="loader-2" className="animate-spin" /> 處理中...
                                </>
                            ) : "提交申請"}
                        </button>
                    </div>

                    {showSignaturePad && (
                        <SignaturePad 
                            onClose={() => setShowSignaturePad(false)} 
                            onSave={setSignature} 
                        />
                    )}
                </div>
            );
        };

        // --- View 3 & 4: Status Tracking ---
        const StatusView = ({ status, completionDate }) => {
            const isCompleted = status === 'completed';
            
            const steps = [
                { id: 1, title: "提交申請", date: "2023/10/24", completed: true },
                { id: 2, title: "資料審核", date: "2023/10/25", completed: true },
                { id: 3, title: "銀行作業", date: isCompleted ? "2023/11/01" : "處理中", completed: isCompleted, current: !isCompleted },
                { id: 4, title: "退款完成", date: isCompleted ? completionDate : "預計 2-4 週", completed: isCompleted, current: isCompleted },
            ];

            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [status]);

            return (
                <div className="app-container bg-white flex flex-col h-screen">
                    <div className="bg-blue-600 p-8 text-white text-center rounded-b-[2.5rem] shadow-lg mb-8">
                        <div className="w-16 h-16 bg-white/20 rounded-full flex items-center justify-center mx-auto mb-4 backdrop-blur-sm">
                            {isCompleted ? (
                                <Icon name="check" size={32} className="text-white" />
                            ) : (
                                <Icon name="clock" size={32} className="text-white animate-pulse" />
                            )}
                        </div>
                        <h2 className="text-2xl font-bold mb-1">
                            {isCompleted ? "退款已入帳" : "退費處理中"}
                        </h2>
                        <p className="text-blue-100 opacity-90">
                            {isCompleted ? `款項已於 ${completionDate} 匯入指定帳戶` : "您的申請正在進行銀行端作業"}
                        </p>
                    </div>

                    <div className="px-6 flex-1">
                        <div className="bg-white border border-gray-100 rounded-xl shadow-sm p-6 mb-6">
                            <div className="flex justify-between items-center mb-4 border-b pb-2">
                                <span className="text-gray-500 text-sm">案件編號</span>
                                <span className="font-mono font-bold text-gray-800">{USER_DATA.caseId}</span>
                            </div>
                            
                            {/* Timeline */}
                            <div className="relative space-y-8 pl-4 py-2">
                                {/* Vertical Line */}
                                <div className="absolute left-[23px] top-4 bottom-4 w-0.5 bg-gray-200"></div>

                                {steps.map((step, idx) => (
                                    <div key={step.id} className="relative flex items-center gap-4 z-10">
                                        <div className={`w-5 h-5 rounded-full border-2 flex items-center justify-center bg-white
                                            ${step.completed ? 'border-green-500 bg-green-500' : 
                                              step.current ? 'border-blue-500 bg-blue-50' : 'border-gray-300'}
                                        `}>
                                            {step.completed && <Icon name="check" size={12} className="text-white" />}
                                            {step.current && <div className="w-2 h-2 rounded-full bg-blue-500 animate-ping"></div>}
                                        </div>
                                        <div className="flex-1">
                                            <p className={`font-bold text-sm ${step.current ? 'text-blue-600' : 'text-gray-800'}`}>
                                                {step.title}
                                            </p>
                                            <p className="text-xs text-gray-400">{step.date}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {!isCompleted && (
                            <div className="bg-yellow-50 p-4 rounded-lg flex gap-3 items-start">
                                <Icon name="info" className="text-yellow-600 shrink-0 mt-0.5" size={18} />
                                <div className="text-sm text-yellow-800">
                                    <p className="font-bold mb-1">預計作業時間</p>
                                    <p>配合銀行作業流程，退款通常需要 2-4 週的工作天。請您耐心等候。</p>
                                </div>
                            </div>
                        )}
                        
                        {isCompleted && (
                            <div className="text-center mt-8">
                                <button className="text-blue-600 text-sm font-medium hover:underline">
                                    查看電子收據
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- Main Controller ---
        const App = () => {
            // State: 'sms' | 'form' | 'processing' | 'completed'
            // We read from localStorage to simulate the "come back later" persistence
            const [view, setView] = useState('sms');
            const [completionDate, setCompletionDate] = useState(null);

            useEffect(() => {
                const savedState = localStorage.getItem('refundAppState');
                const savedDate = localStorage.getItem('refundCompletionDate');
                
                if (savedState) {
                    // If user has history, don't show SMS, simulate them clicking the link directly to the app
                    // However, for this demo, we'll start at SMS but if they click the link, it jumps to correct state
                }
                if (savedDate) setCompletionDate(savedDate);
                
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, []);

            const handleSMSLinkClick = () => {
                const savedState = localStorage.getItem('refundAppState');
                if (savedState === 'processing' || savedState === 'completed') {
                    setView(savedState);
                } else {
                    setView('form');
                }
            };

            const handleFormSubmit = () => {
                const newState = 'processing';
                setView(newState);
                localStorage.setItem('refundAppState', newState);
            };

            // Debug Tools to simulate time passing
            const debugSetStatus = (status) => {
                setView(status);
                localStorage.setItem('refundAppState', status);
                if (status === 'completed') {
                    const date = "2023/11/15";
                    setCompletionDate(date);
                    localStorage.setItem('refundCompletionDate', date);
                }
                if (status === 'sms') {
                    localStorage.clear();
                    setCompletionDate(null);
                }
            };

            return (
                <div>
                    {view === 'sms' && <SMSView onLinkClick={handleSMSLinkClick} />}
                    {view === 'form' && <RefundFormView onSubmit={handleFormSubmit} />}
                    {(view === 'processing' || view === 'completed') && (
                        <StatusView status={view} completionDate={completionDate} />
                    )}

                    {/* Developer Tools Panel (For Simulation) */}
                    <div className="fixed bottom-0 right-0 left-0 bg-gray-800 text-white p-2 text-xs opacity-90 z-50 flex justify-center gap-2">
                        <span className="font-bold py-1 px-2 border-r border-gray-600">開發測試區:</span>
                        <button onClick={() => debugSetStatus('sms')} className="hover:text-blue-300 py-1 px-2">重置流程</button>
                        <button onClick={() => debugSetStatus('processing')} className="hover:text-blue-300 py-1 px-2">模擬: 處理中</button>
                        <button onClick={() => debugSetStatus('completed')} className="hover:text-blue-300 py-1 px-2">模擬: 退款完成</button>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
apps-fileview.texmex_20260108.00_p0
!DOCTYPE html.html
目前顯示的是「!DOCTYPE html.html」。
