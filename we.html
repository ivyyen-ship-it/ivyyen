<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智生活公告專區</title>
    <!-- 引入 React 核心庫 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Tailwind CSS 用於美化 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Lucide 圖示庫 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #F7FBFA;
        }
        .tiffany-bg { background-color: #81D8D0; }
        .tiffany-text { color: #4A8F88; }
        .tiffany-border { border-color: #E0F2F0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { 
            Bell, CheckCircle, AlertCircle, Users, ChevronRight, 
            ClipboardCheck, LayoutDashboard, Megaphone, PlusCircle, 
            X, Send, UserCheck, Clock 
        } = lucide;

        // 部門成員清單
        const STAFF_LIST = [
            { id: 1, dept: '電銷部', title: '經理', name: '郭雅玲', nickname: 'Vivian' },
            { id: 2, dept: '電銷部', title: '培訓師', name: '嚴婕瑜', nickname: '小艾' },
            { id: 3, dept: '電銷部', title: '管理師', name: '沈姵妤', nickname: '' },
            { id: 4, dept: '電銷部', title: '業助', name: '吳宜庭', nickname: '' },
            { id: 5, dept: '電銷部', title: '業務', name: '李家榛', nickname: '' },
            { id: 6, dept: '電銷部', title: '業務', name: '黃鈞霖', nickname: '' },
            { id: 7, dept: '電銷部', title: '業務', name: '蕭茜文', nickname: '' },
            { id: 8, dept: '電銷部', title: '業務', name: '葉潭', nickname: '小葉' },
            { id: 9, dept: '電銷部', title: '業務', name: '陳鐿瑄', nickname: '' },
            { id: 10, dept: '電銷部', title: '業務', name: '楊曉念', nickname: '' },
            { id: 11, dept: '電銷部', title: '業務', name: '張妤甄', nickname: '' },
            { id: 12, dept: '電銷部', title: '業務', name: '卓于琬', nickname: '' },
            { id: 13, dept: '電銷部', title: '業務', name: '吳昀庭', nickname: '' },
        ];

        const App = () => {
            const [announcements, setAnnouncements] = useState([
                {
                    id: 'ann-001',
                    authorId: 1,
                    title: '電銷話務流程標準化調整',
                    content: '請各位夥伴注意，自明日起進線標籤需統一標記「A級意向」。',
                    createdAt: '2024-05-20 09:00',
                    priority: 'high',
                    targetStaffIds: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13],
                    readBy: [1, 2, 13]
                }
            ]);

            const [currentUserId, setCurrentUserId] = useState(1);
            const [activeTab, setActiveTab] = useState('lobby');
            const [selectedAnn, setSelectedAnn] = useState(null);
            const [showCreateModal, setShowCreateModal] = useState(false);

            const [newAnn, setNewAnn] = useState({
                title: '',
                content: '',
                priority: 'normal',
                targetStaffIds: STAFF_LIST.map(s => s.id)
            });

            const formatName = (fullName) => fullName.length > 2 ? fullName.substring(fullName.length - 2) : fullName;

            const incompleteAnnouncements = useMemo(() => {
                return announcements.filter(ann => ann.readBy.length < ann.targetStaffIds.length);
            }, [announcements]);

            const myRelevantAnnouncements = useMemo(() => {
                return announcements.filter(ann => ann.targetStaffIds.includes(currentUserId));
            }, [announcements, currentUserId]);

            const handleConfirmRead = (annId) => {
                setAnnouncements(prev => prev.map(ann => {
                    if (ann.id === annId && !ann.readBy.includes(currentUserId)) {
                        return { ...ann, readBy: [...ann.readBy, currentUserId] };
                    }
                    return ann;
                }));
                setSelectedAnn(null);
            };

            const handleCreateAnnouncement = () => {
                if (!newAnn.title || !newAnn.content) return;
                const newEntry = {
                    ...newAnn,
                    id: `ann-${Date.now()}`,
                    authorId: currentUserId,
                    createdAt: new Date().toLocaleString(),
                    readBy: [currentUserId]
                };
                setAnnouncements([newEntry, ...announcements]);
                setShowCreateModal(false);
                setNewAnn({ title: '', content: '', priority: 'normal', targetStaffIds: STAFF_LIST.map(s => s.id) });
            };

            const toggleTargetStaff = (staffId) => {
                setNewAnn(prev => ({
                    ...prev,
                    targetStaffIds: prev.targetStaffIds.includes(staffId)
                        ? prev.targetStaffIds.filter(id => id !== staffId)
                        : [...prev.targetStaffIds, staffId]
                }));
            };

            const currentUser = STAFF_LIST.find(s => s.id === currentUserId);

            return (
                <div className="min-h-screen pb-12">
                    <header className="bg-white border-b border-[#E0F2F0] sticky top-0 z-40 shadow-sm">
                        <div className="max-w-6xl mx-auto px-6 h-20 flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="bg-[#81D8D0] p-2.5 rounded-2xl shadow-sm text-white">
                                    <i data-lucide="megaphone"></i>
                                </div>
                                <div>
                                    <h1 className="text-2xl font-black tracking-tight text-[#4A8F88]">智生活公告專區</h1>
                                    <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Smart Life Announcement</p>
                                </div>
                            </div>
                            <div className="flex items-center space-x-6">
                                <button 
                                    onClick={() => setShowCreateModal(true)}
                                    className="hidden md:flex items-center px-4 py-2.5 bg-[#81D8D0] hover:bg-[#6ec9c1] text-white rounded-xl font-bold transition-all shadow-md shadow-[#81d8d044]"
                                >
                                    <i data-lucide="plus-circle" className="mr-2 w-5 h-5"></i>
                                    發佈新公告
                                </button>
                                <div className="flex items-center text-right">
                                    <div className="mr-3 hidden sm:block">
                                        <p className="text-xs text-slate-400 font-medium">{currentUser.dept}</p>
                                        <p className="text-sm font-bold text-slate-700">{currentUser.name}</p>
                                    </div>
                                    <div className="w-12 h-12 rounded-2xl bg-[#E0F2F0] flex items-center justify-center text-[#4A8F88] font-black border-2 border-white shadow-sm">
                                        {formatName(currentUser.name)}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-6xl mx-auto p-6 space-y-8">
                        <div className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div className="flex space-x-2 bg-[#E0F2F0]/50 p-1.5 rounded-2xl w-fit border border-white">
                                <button onClick={() => setActiveTab('lobby')} className={`flex items-center px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${activeTab === 'lobby' ? 'bg-white shadow-md text-[#4A8F88]' : 'text-slate-500'}`}>數據大廳</button>
                                <button onClick={() => setActiveTab('my')} className={`flex items-center px-6 py-2.5 rounded-xl text-sm font-bold transition-all ${activeTab === 'my' ? 'bg-white shadow-md text-[#4A8F88]' : 'text-slate-500'}`}>我的收件夾</button>
                            </div>
                            <div className="flex items-center space-x-2 overflow-x-auto pb-2">
                                <span className="text-xs font-bold text-slate-400 whitespace-nowrap">切換角色:</span>
                                {STAFF_LIST.slice(0, 5).map(staff => (
                                    <button key={staff.id} onClick={() => setCurrentUserId(staff.id)} className={`text-[10px] px-3 py-1.5 rounded-lg border font-bold ${currentUserId === staff.id ? 'bg-[#4A8F88] text-white' : 'bg-white text-slate-500'}`}>{formatName(staff.name)}</button>
                                ))}
                            </div>
                        </div>

                        {activeTab === 'lobby' ? (
                            <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                                <div className="lg:col-span-4 space-y-6">
                                    <div className="bg-white p-8 rounded-[2rem] shadow-sm border border-[#E0F2F0] relative overflow-hidden">
                                        <h3 className="text-slate-400 font-bold text-sm mb-2">待全員簽署公告</h3>
                                        <div className="text-6xl font-black text-[#4A8F88] mb-4">{incompleteAnnouncements.length}</div>
                                        <p className="text-xs text-slate-400 leading-relaxed font-medium">目前有 {incompleteAnnouncements.length} 則公告尚未完成，請督促讀取進度。</p>
                                    </div>
                                </div>
                                <div className="lg:col-span-8 space-y-6">
                                    <h2 className="text-xl font-black text-slate-800">即時追蹤進度</h2>
                                    {incompleteAnnouncements.map(ann => {
                                        const unreadStaff = STAFF_LIST.filter(s => ann.targetStaffIds.includes(s.id) && !ann.readBy.includes(s.id));
                                        const progress = Math.round((ann.readBy.length / ann.targetStaffIds.length) * 100);
                                        return (
                                            <div key={ann.id} className="bg-white rounded-[1.5rem] border border-[#E0F2F0] p-6 shadow-sm">
                                                <div className="flex justify-between items-start mb-4">
                                                    <div>
                                                        <h4 className="font-black text-lg text-slate-800">{ann.title}</h4>
                                                        <p className="text-xs text-slate-400">{ann.createdAt}</p>
                                                    </div>
                                                    <div className="text-right text-[#4A8F88] font-black text-2xl">{progress}%</div>
                                                </div>
                                                <div className="w-full h-1.5 bg-slate-100 rounded-full mb-6">
                                                    <div className="h-full bg-[#81D8D0] rounded-full" style={{ width: `${progress}%` }}></div>
                                                </div>
                                                <div className="flex flex-wrap gap-2">
                                                    {unreadStaff.map(s => <span key={s.id} className="text-[11px] font-bold px-3 py-1 bg-slate-50 border rounded-xl">{formatName(s.name)}</span>)}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {myRelevantAnnouncements.map(ann => {
                                    const isRead = ann.readBy.includes(currentUserId);
                                    return (
                                        <div key={ann.id} onClick={() => setSelectedAnn(ann)} className={`p-6 rounded-3xl border cursor-pointer bg-white ${isRead ? 'border-slate-100' : 'border-[#81D8D0] ring-1 ring-[#81D8D0]'}`}>
                                            <div className="flex items-center justify-between">
                                                <div className="flex items-center space-x-4">
                                                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${isRead ? 'bg-slate-50 text-slate-300' : 'bg-[#E0F2F0] text-[#4A8F88]'}`}>
                                                        <i data-lucide={isRead ? "check-circle" : "bell"}></i>
                                                    </div>
                                                    <h4 className={`font-black text-lg ${isRead ? 'text-slate-500' : 'text-slate-900'}`}>{ann.title}</h4>
                                                </div>
                                                <i data-lucide="chevron-right" className="text-slate-300"></i>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </main>

                    {showCreateModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-[#4A8F88]/40 backdrop-blur-md">
                            <div className="bg-white w-full max-w-4xl max-h-[90vh] rounded-[2.5rem] shadow-2xl flex flex-col overflow-hidden">
                                <div className="p-8 border-b flex justify-between items-center">
                                    <h2 className="text-2xl font-black text-[#4A8F88]">發佈新公告</h2>
                                    <button onClick={() => setShowCreateModal(false)} className="text-slate-400">✕</button>
                                </div>
                                <div className="flex-1 overflow-y-auto p-8 grid grid-cols-1 lg:grid-cols-2 gap-8">
                                    <div className="space-y-6">
                                        <input type="text" placeholder="標題" className="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-[#81D8D0] outline-none" value={newAnn.title} onChange={e => setNewAnn({...newAnn, title: e.target.value})} />
                                        <textarea rows="6" placeholder="內容" className="w-full px-4 py-3 border rounded-xl outline-none" value={newAnn.content} onChange={e => setNewAnn({...newAnn, content: e.target.value})} />
                                    </div>
                                    <div className="bg-slate-50 p-6 rounded-[2rem] border overflow-y-auto max-h-[400px]">
                                        <p className="text-sm font-black mb-4 tiffany-text">指定必讀人員</p>
                                        <div className="grid grid-cols-2 gap-2">
                                            {STAFF_LIST.map(s => (
                                                <button key={s.id} onClick={() => toggleTargetStaff(s.id)} className={`px-3 py-2 rounded-xl border text-xs font-bold ${newAnn.targetStaffIds.includes(s.id) ? 'bg-[#81D8D0] text-white border-[#81D8D0]' : 'bg-white text-slate-500'}`}>
                                                    {formatName(s.name)}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                </div>
                                <div className="p-8 border-t flex justify-end">
                                    <button onClick={handleCreateAnnouncement} className="px-10 py-4 bg-[#4A8F88] text-white rounded-2xl font-black">立即發佈</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {selectedAnn && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-[#2C524E]/80 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-xl rounded-[3rem] p-10">
                                <h2 className="text-3xl font-black text-slate-800 mb-6">{selectedAnn.title}</h2>
                                <div className="bg-[#F7FBFA] p-8 rounded-[2rem] mb-10 border">{selectedAnn.content}</div>
                                {selectedAnn.readBy.includes(currentUserId) ? (
                                    <div className="text-center py-5 bg-[#E0F2F0] rounded-2xl tiffany-text font-black">您已完成確認</div>
                                ) : (
                                    <button onClick={() => handleConfirmRead(selectedAnn.id)} className="w-full bg-[#81D8D0] text-white font-black py-6 rounded-[1.5rem] shadow-lg">確認已詳讀</button>
                                )}
                                <button onClick={() => setSelectedAnn(null)} className="w-full mt-4 text-slate-400 text-sm font-bold">關閉窗口</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // 初始化圖示
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
