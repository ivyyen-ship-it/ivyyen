<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™ºç”Ÿæ´»ä»Šç¶²å¯¬é »é›™ç¶²æ–¹æ¡ˆå„ªæƒ è©¦ç®—</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f7f7;
            background-image: linear-gradient(135deg, #ffffff 0%, #e0f2f1 100%);
            min-height: 100vh;
            color: #37474f;
            position: relative;
            overflow-x: hidden;
        }
        .tiffany-card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 24px;
            box-shadow: 0 10px 30px rgba(129, 203, 196, 0.15);
            border: 1px solid #ffffff;
            backdrop-filter: blur(10px);
        }
        .tiffany-input {
            background: #ffffff;
            border: 1.5px solid #b2dfdb;
            border-radius: 12px;
            padding: 10px 14px;
            color: #263238;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        .placeholder-style {
            color: #9ca3af !important;
        }
        .tiffany-input option {
            color: #263238;
        }
        .tiffany-input:focus {
            border-color: #4db6ac;
            outline: none;
            box-shadow: 0 0 0 3px rgba(77, 182, 172, 0.2);
        }
        .btn-logic {
            background-color: #f1f8f7;
            color: #90a4ae;
            border: 1.5px dashed #b2dfdb;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-logic-active {
            background-color: #4db6ac !important;
            color: #ffffff !important;
            border: 1.5px solid #00897b !important;
            box-shadow: 0 4px 10px rgba(77, 182, 172, 0.3);
            font-weight: 800;
        }
        .btn-line {
            background: linear-gradient(135deg, #4db6ac 0%, #26a69a 100%);
            box-shadow: 0 8px 20px rgba(38, 166, 154, 0.25);
            animation: pulse 2.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .label-text {
            color: #546e7a;
            font-weight: 700;
            font-size: 0.85rem;
            margin-bottom: 4px;
            display: block;
        }
        .warning-box {
            background-color: #fffaf0;
            border: 2px solid #feebc8;
            border-radius: 16px;
        }
        .hidden { display: none; }
        
        .highlight-red {
            color: #e53935;
            font-size: 2.2rem;
            font-weight: 900;
            line-height: 1.1;
            display: block;
            text-align: left;
            padding-left: 1.5rem;
            margin-top: 4px;
        }
        .normal-text {
            font-size: 1.1rem;
            font-weight: 800;
            color: #37474f;
            display: block;
            text-align: left;
        }
        .phone-item {
            border-left: 4px solid #4db6ac;
            background: #ffffff;
        }
        .summary-item {
            padding: 10px 8px;
            border-radius: 8px;
            background: #f1f8f7;
            border-left: 3px solid #81cbd4;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 4px;
        }
        .summary-label {
            flex-shrink: 0;
            white-space: nowrap;
        }
        .summary-value {
            flex-grow: 1;
            text-align: right;
            white-space: nowrap;
            letter-spacing: -0.3px;
        }
        .over-limit-hint {
            color: #00897b;
            font-size: 0.85rem;
            font-weight: 700;
            display: block;
            margin-top: 8px;
            padding-left: 1.5rem;
            line-height: 1.4;
        }
    </style>
</head>
<body class="py-10 px-4">

    <div class="max-w-md mx-auto relative z-10">
        <!-- Header -->
        <div class="text-center mb-8 pt-4">
            <h1 class="text-3xl font-black tracking-tighter mb-2 text-[#00796b]">æ™ºç”Ÿæ´»ä»Šç¶²å¯¬é »</h1>
            <p class="text-lg font-bold text-[#4db6ac]">é›™ç¶²æ–¹æ¡ˆå„ªæƒ è©¦ç®—</p>
            <div class="h-1.5 w-16 bg-[#81cbd4] mx-auto rounded-full mt-4"></div>
        </div>

        <!-- 1. å¯¬é »ç‹€æ…‹ (å…¨å±€) -->
        <div class="tiffany-card p-6 mb-6">
            <label class="label-text">1. ä»Šç¶²å¯¬é »ç¶²è·¯åˆç´„ç‹€æ…‹</label>
            <select id="broadband-status" class="tiffany-input w-full appearance-none placeholder-style" onchange="handleSelectColor(event); calculateAll()">
                <option value="" disabled selected>è«‹é¸æ“‡...</option>
                <option value="discount">ç¶²è·¯æ–°ç”³è£</option>
                <option value="months">ä»Šç¶²ç”¨æˆ¶å³å°‡çºŒç´„-ä¸é ˆä»˜æ¬¾æ–¹æ¡ˆ</option>
                <option value="discount">ä»Šç¶²ç”¨æˆ¶åˆ°æœŸæ—¥åŠå¹´å…§-å¯æå‰çºŒç´„æ–¹æ¡ˆ</option>
                <option value="months">ä»Šç¶²ç”¨æˆ¶åˆ°æœŸæ—¥è¶…éåŠå¹´-ä¸é ˆä»˜æ¬¾æ–¹æ¡ˆ</option>
            </select>
        </div>

        <!-- 2. é–€è™Ÿæ¸…å–® -->
        <div id="phone-list" class="space-y-4 mb-6">
            <!-- é–€è™Ÿé …ç›®æœƒå‹•æ…‹ç”Ÿæˆæ–¼æ­¤ -->
        </div>

        <!-- æ–°å¢é–€è™ŸæŒ‰éˆ• -->
        <button onclick="addPhone()" class="w-full py-4 mb-8 border-2 border-dashed border-[#4db6ac] rounded-2xl text-[#00796b] font-bold flex items-center justify-center gap-2 bg-white/50 hover:bg-teal-50 transition-colors">
            <span class="text-xl">+</span> æ–°å¢å¦ä¸€å€‹é–€è™Ÿ
        </button>

        <!-- Result -->
        <div class="tiffany-card p-7 result-panel shadow-lg mb-10">
            <h2 class="text-xl font-bold mb-6 flex items-center text-[#00796b]"><span class="mr-2">âœ¦</span> ç¸½è¨ˆè©¦ç®—çµæœ</h2>
            <div class="space-y-6">
                <div class="py-4 border-b border-[#e0f2f1]">
                    <p class="text-[11px] text-[#4db6ac] font-bold uppercase mb-3 tracking-widest">å„é–€è™Ÿå„ªæƒ æ˜ç´°</p>
                    <div id="res-summary-list" class="space-y-3">
                        <!-- é–€è™Ÿç¨ç«‹é¡¯ç¤º -->
                    </div>
                </div>
                
                <div>
                    <p class="text-[11px] text-[#4db6ac] font-bold uppercase mb-2 tracking-widest">ç¸½è¨ˆå°ˆå±¬å„ªæƒ å…§å®¹</p>
                    <div id="res-total-discount" class="leading-relaxed min-h-[80px]">
                        <!-- ç¸½è¨ˆçµæœ -->
                    </div>
                </div>

                <div class="warning-box p-4 space-y-2">
                    <p class="text-[13px] text-[#c05621] font-bold leading-relaxed">
                        â€» èªªæ˜1ï¼šå¤šé–€è™Ÿå„ªæƒ å¯å®Œå…¨ç–ŠåŠ ï¼å„é–€è™Ÿå„ªæƒ å…§å®¹å°‡æ–¼è©¦ç®—çµæœä¸­è©³åˆ—ã€‚
                    </p>
                    <p class="text-[13px] text-[#c05621] font-bold leading-relaxed">
                        â€» èªªæ˜2ï¼šå› é›™ç¶²æ–¹æ¡ˆæƒ…å¢ƒä¸åŒå„ªæƒ å¯èƒ½æœ‰æ‰€è®ŠåŒ–ï¼Œå®Œæ•´å„ªæƒ ä»éœ€ç”±é›»ä¿¡å°ˆå“¡èªªæ˜æœ€æº–ç¢ºå–”ï¼
                    </p>
                </div>

                <a href="https://lin.ee/CPfNPRt" target="_blank" class="btn-line w-full flex flex-col items-center justify-center py-5 rounded-2xl text-white no-underline px-4 text-center">
                    <span class="text-xl font-black mb-1">ç«‹å³åŠ lineæ‰¾æœå‹™å°ˆå“¡</span>
                    <span class="text-xs font-bold opacity-90">æ™ºç”Ÿæ´»å°ˆå±¬æœå‹™ï¼Œç«‹å³é ˜å–éš±è—ç¦åˆ©</span>
                </a>
            </div>
        </div>
    </div>

    <script>
        const planData = {
            'discount': { 
                'np': [
                    { brand: 'é å‚³', price: 399, reward: 1500, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 599, reward: 3500, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 799, reward: 6000, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 999, reward: 24, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 1399, reward: 30, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true },
                    { brand: 'ä¸­è¯', price: 599, reward: 3000, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 699, reward: 1500, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 799, reward: 6000, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 999, reward: 24, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 1399, reward: 30, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true }
                ],
                'new': [
                    { brand: 'é å‚³', price: 399, reward: 1000, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 599, reward: 3000, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 799, reward: 5000, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 999, reward: 7000, extra: '', isMonth: false },
                    { brand: 'é å‚³', price: 1399, reward: 30, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true },
                    { brand: 'ä¸­è¯', price: 599, reward: 2500, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 699, reward: 1000, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 799, reward: 5000, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 999, reward: 7000, extra: '', isMonth: false },
                    { brand: 'ä¸­è¯', price: 1399, reward: 30, extra: '', isMonth: true }
                ]
            },
            'months': { 
                'np': [
                    { brand: 'é å‚³', price: 399, reward: 4, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 599, reward: 9, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 799, reward: 16, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 999, reward: 24, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 1399, reward: 24, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true },
                    { brand: 'ä¸­è¯', price: 599, reward: 8, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 799, reward: 16, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 999, reward: 24, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 1399, reward: 30, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true }
                ],
                'new': [
                    { brand: 'é å‚³', price: 399, reward: 3, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 599, reward: 8, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 799, reward: 13, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 999, reward: 19, extra: '', isMonth: true },
                    { brand: 'é å‚³', price: 1399, reward: 30, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true },
                    { brand: 'ä¸­è¯', price: 599, reward: 6, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 799, reward: 13, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 999, reward: 19, extra: '', isMonth: true },
                    { brand: 'ä¸­è¯', price: 1399, reward: 30, extra: '+åˆ†é›¢å¼å†·æ°£æ¸…æ´—ä¸€å°', isMonth: true }
                ]
            }
        };

        function handleSelectColor(e) {
            if (e.target.value) {
                e.target.classList.remove('placeholder-style');
            } else {
                e.target.classList.add('placeholder-style');
            }
        }

        function addPhone() {
            const id = 'phone-' + Date.now();
            const container = document.getElementById('phone-list');
            
            const div = document.createElement('div');
            div.id = id;
            div.className = 'phone-item p-5 rounded-2xl shadow-sm space-y-4 relative';
            div.dataset.applyType = 'np';
            div.dataset.npMethod = 'auto'; 
            div.dataset.targetBrand = ''; 
            
            div.innerHTML = `
                <div class="flex justify-between items-center mb-1">
                    <span class="bg-teal-100 text-teal-700 px-3 py-1 rounded-full text-xs font-black italic phone-idx-label">é–€è™Ÿ #${container.children.length + 1}</span>
                    ${container.children.length > 0 ? `<button onclick="removePhone('${id}')" class="text-gray-400 text-xs font-bold hover:text-red-500">ç§»é™¤ Ã—</button>` : ''}
                </div>
                
                <div>
                    <label class="label-text">2. æ‚¨ç›®å‰çš„é›»ä¿¡é–€è™Ÿ</label>
                    <select class="tiffany-input w-full current-telco placeholder-style" onchange="handleSelectColor(event); updatePhoneLogic('${id}')">
                        <option value="" disabled selected>è«‹é¸æ“‡...</option>
                        <option value="cht">ä¸­è¯é›»ä¿¡</option>
                        <option value="fet">é å‚³é›»ä¿¡</option>
                        <option value="twn">å°ç£å¤§å“¥å¤§</option>
                    </select>
                </div>

                <div>
                    <label class="label-text">3. è¾¦ç†é¡åˆ¥</label>
                    <div class="flex flex-col gap-2">
                        <button class="flex-1 py-3 px-2 rounded-lg text-[11px] font-bold btn-logic btn-logic-active btn-type-np leading-tight" onclick="setPhoneApplyType('${id}', 'np')">æ”œç¢¼<br>(è™Ÿç¢¼ä¸è®Šï¼Œæ”¹ç”¨å…¶ä»–é›»ä¿¡æ¥­è€…)</button>
                        <button class="flex-1 py-3 px-2 rounded-lg text-[11px] font-bold btn-logic btn-type-new leading-tight" onclick="setPhoneApplyType('${id}', 'new')">æ–°è¾¦é–€è™Ÿ<br>(æ–°çš„æ‰‹æ©Ÿè™Ÿç¢¼)</button>
                    </div>
                </div>

                <!-- æ”œç¢¼å°ˆå±¬ï¼šç›®æ¨™é›»ä¿¡é¸æ“‡ -->
                <div class="target-brand-selection-box hidden space-y-3">
                    <label class="label-text">æƒ³äº†è§£å“ªå®¶é›»ä¿¡ï¼Ÿ</label>
                    <div class="flex gap-2">
                        <button class="flex-1 py-3 rounded-xl text-[11px] font-bold btn-logic btn-target-cht" onclick="setTargetBrand('${id}', 'ä¸­è¯')">ä¸­è¯é›»ä¿¡</button>
                        <button class="flex-1 py-3 rounded-xl text-[11px] font-bold btn-logic btn-target-fet" onclick="setTargetBrand('${id}', 'é å‚³')">é å‚³é›»ä¿¡</button>
                    </div>
                </div>

                <!-- äº†è§£æ–¹å¼ -->
                <div class="np-method-container hidden space-y-3">
                    <label class="label-text">4. é¸æ“‡å„ªæƒ äº†è§£æ–¹å¼</label>
                    <div class="flex gap-2">
                        <button class="flex-1 py-3 rounded-xl text-[10px] leading-tight font-bold btn-logic btn-logic-active btn-method-auto" onclick="setNpMethod('${id}', 'auto')">A. æ¯”ç…§æˆ‘ç›®å‰<br>çš„è³‡è²»æ–¹æ¡ˆ</button>
                        <button class="flex-1 py-3 rounded-xl text-[10px] leading-tight font-bold btn-logic btn-method-manual" onclick="setNpMethod('${id}', 'manual')">B. æˆ‘æƒ³äº†è§£å…¶ä»–<br>è³‡è²»å„ªæƒ </button>
                    </div>
                    <div class="auto-input-box p-3 bg-teal-50 rounded-lg">
                        <label class="text-[10px] font-bold text-teal-600 mb-1 block">è¼¸å…¥ç›®å‰é–€è™Ÿæœˆè³‡è²»</label>
                        <input type="number" class="tiffany-input w-full current-price-input" placeholder="ä¾‹: 599" oninput="calculateAll()">
                    </div>
                </div>

                <!-- æ‰‹å‹•æ–¹æ¡ˆé¸æ“‡å€å¡Š -->
                <div class="manual-container hidden space-y-3">
                    <div>
                        <label class="label-text">é¸æ“‡è³‡è²»æ–¹æ¡ˆ</label>
                        <select class="tiffany-input w-full plan-select placeholder-style" onchange="handleSelectColor(event); calculateAll()">
                            <option value="" disabled selected>è«‹é¸æ“‡...</option>
                        </select>
                    </div>
                </div>
            `;
            container.appendChild(div);
            updatePhoneLogic(id, true);
        }

        function removePhone(id) {
            document.getElementById(id).remove();
            const labels = document.querySelectorAll('.phone-idx-label');
            labels.forEach((l, i) => l.textContent = `é–€è™Ÿ #${i + 1}`);
            calculateAll();
        }

        function setPhoneApplyType(id, type) {
            const el = document.getElementById(id);
            el.dataset.applyType = type;
            el.querySelector('.btn-type-np').classList.toggle('btn-logic-active', type === 'np');
            el.querySelector('.btn-type-new').classList.toggle('btn-logic-active', type === 'new');
            updatePhoneLogic(id);
        }

        function setNpMethod(id, method) {
            const el = document.getElementById(id);
            el.dataset.npMethod = method;
            el.querySelector('.btn-method-auto').classList.toggle('btn-logic-active', method === 'auto');
            el.querySelector('.btn-method-manual').classList.toggle('btn-logic-active', method === 'manual');
            updatePhoneLogic(id);
        }

        function setTargetBrand(id, brand) {
            const el = document.getElementById(id);
            el.dataset.targetBrand = brand;
            el.querySelector('.btn-target-cht').classList.toggle('btn-logic-active', brand === 'ä¸­è¯');
            el.querySelector('.btn-target-fet').classList.toggle('btn-logic-active', brand === 'é å‚³');
            updatePhoneLogic(id);
        }

        function updatePhoneLogic(id, isInit = false) {
            const el = document.getElementById(id);
            const curTelco = el.querySelector('.current-telco').value;
            const applyType = el.dataset.applyType;
            const npMethod = el.dataset.npMethod;
            
            const targetBrandBox = el.querySelector('.target-brand-selection-box');
            const npContainer = el.querySelector('.np-method-container');
            const autoInputBox = el.querySelector('.auto-input-box');
            const manualContainer = el.querySelector('.manual-container');

            targetBrandBox.classList.add('hidden');
            npContainer.classList.add('hidden');
            manualContainer.classList.add('hidden');

            if (applyType === 'np') {
                if (curTelco === 'cht') {
                    el.dataset.targetBrand = 'é å‚³';
                } else if (curTelco === 'fet') {
                    el.dataset.targetBrand = 'ä¸­è¯';
                } else if (curTelco === 'twn') {
                    targetBrandBox.classList.remove('hidden');
                }

                if (el.dataset.targetBrand === 'ä¸­è¯' || el.dataset.targetBrand === 'é å‚³') {
                    npContainer.classList.remove('hidden');
                    if (npMethod === 'auto') {
                        autoInputBox.classList.remove('hidden');
                        manualContainer.classList.add('hidden');
                    } else {
                        autoInputBox.classList.add('hidden');
                        manualContainer.classList.remove('hidden');
                    }
                }
            } else {
                targetBrandBox.classList.remove('hidden');
                if (el.dataset.targetBrand === 'ä¸­è¯' || el.dataset.targetBrand === 'é å‚³') {
                    manualContainer.classList.remove('hidden');
                }
            }

            if (!isInit && curTelco !== el.dataset.lastTelco) {
                if (curTelco === 'twn') {
                    el.dataset.targetBrand = '';
                    el.querySelectorAll('.btn-target-cht, .btn-target-fet').forEach(b => b.classList.remove('btn-logic-active'));
                }
            }

            el.dataset.lastTelco = curTelco;
            updatePlanOptions(id);
            calculateAll();
        }

        function updatePlanOptions(id) {
            const el = document.getElementById(id);
            const status = document.getElementById('broadband-status').value;
            const applyType = el.dataset.applyType;
            const brand = el.dataset.targetBrand;
            const select = el.querySelector('.plan-select');

            if (!status || !brand) {
                select.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡...</option>';
                select.classList.add('placeholder-style');
                return;
            }

            let filterPrices = [399, 599, 699, 799, 999, 1399];
            if (brand === 'ä¸­è¯' && applyType === 'new') filterPrices = [599, 699, 799, 999, 1399];

            const plans = planData[status][applyType].filter(p => p.brand === brand && filterPrices.includes(p.price));
            
            select.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡...</option>';
            select.classList.add('placeholder-style');
            
            plans.forEach(p => {
                const opt = document.createElement('option');
                opt.value = JSON.stringify(p);
                opt.textContent = `${p.brand} ${p.price}å‹`;
                select.appendChild(opt);
            });
        }

        function calculateAll() {
            const status = document.getElementById('broadband-status').value;
            const phoneItems = document.querySelectorAll('.phone-item');
            const summaryList = document.getElementById('res-summary-list');
            const totalContainer = document.getElementById('res-total-discount');
            
            summaryList.innerHTML = '';
            let totalReward = 0;
            let totalMonths = 0;
            let finalExtras = []; 
            let validCount = 0;

            if (!status) {
                totalContainer.innerHTML = '<p class="text-gray-400 font-bold italic">è«‹å…ˆé¸æ“‡ç¶²è·¯åˆç´„ç‹€æ…‹</p>';
                return;
            }

            phoneItems.forEach((item, i) => {
                const applyType = item.dataset.applyType;
                const npMethod = item.dataset.npMethod;
                const targetBrand = item.dataset.targetBrand;
                const typeText = (applyType === 'np') ? 'æ”œç¢¼' : 'æ–°è¾¦';
                
                let finalPlan = null;

                if (applyType === 'np' && npMethod === 'auto') {
                    const currentPrice = parseInt(item.querySelector('.current-price-input').value);
                    if (currentPrice && targetBrand) {
                        const plans = planData[status]['np'].filter(p => p.brand === targetBrand);
                        finalPlan = plans.sort((a,b) => a.price - b.price).find(p => p.price >= currentPrice) || plans[plans.length-1];
                    }
                } else {
                    const selectVal = item.querySelector('.plan-select').value;
                    if (selectVal) finalPlan = JSON.parse(selectVal);
                }

                if (finalPlan) {
                    validCount++;
                    let isMonthType = finalPlan.isMonth === true;
                    
                    const itemRewardStr = isMonthType 
                        ? `è´ˆç¶²è·¯${finalPlan.reward}å€‹æœˆ` 
                        : `ç¾æŠ˜${finalPlan.reward}å…ƒ`;
                    
                    const itemExtraStr = finalPlan.extra ? `${finalPlan.extra}` : '';
                    
                    if (isMonthType) totalMonths += finalPlan.reward;
                    else totalReward += finalPlan.reward;
                    
                    if (finalPlan.extra) {
                        const extraText = finalPlan.extra.replace('+', '');
                        finalExtras.push(extraText);
                    }
                    
                    const div = document.createElement('div');
                    div.className = 'summary-item';
                    div.innerHTML = `
                        <div class="summary-label text-[13px]">
                            <span class="font-black text-[#00796b]">#${i+1}</span>
                            <span class="font-bold text-gray-700 ml-1">${typeText}${finalPlan.brand}${finalPlan.price}</span>
                        </div>
                        <div class="summary-value text-[11px] font-black text-[#e53935]">
                            ${itemRewardStr}${itemExtraStr}
                        </div>
                    `;
                    summaryList.appendChild(div);
                }
            });

            if (validCount === 0) {
                totalContainer.innerHTML = '<p class="text-gray-400 font-bold italic">è«‹å®Œæ•´å¡«å¯«è³‡è¨Šä»¥é–‹å§‹è©¦ç®—</p>';
                return;
            }

            let totalHtml = '';
            if (totalReward > 0) {
                totalHtml += `
                    <div class="mb-2">
                        <span class="normal-text">ç¶²è·¯è³‡è²»ç¾æŠ˜</span>
                        <span class="highlight-red">${totalReward}å…ƒ</span>
                        ${totalReward > 8900 ? `<span class="over-limit-hint">ğŸ‰å„ªæƒ å›é¥‹å·²è¶…é 24 å€‹æœˆç¶²è·¯è²»ï¼å¿«é»æ“Šä¸‹æ–¹åŠ  Line è®“å°ˆå“¡ç®—çµ¦ä½ çœ‹ğŸ˜Š</span>` : ''}
                    </div>
                `;
            }
            if (totalMonths > 0) {
                totalHtml += `
                    <div>
                        <span class="normal-text">ç›´æ¥è´ˆé€ç¶²è·¯</span>
                        <span class="highlight-red">${totalMonths}å€‹æœˆ</span>
                    </div>
                `;
            }
            if (finalExtras.length > 0) {
                const uniqueExtras = [...new Set(finalExtras)];
                totalHtml += `
                    <div class="mt-2 pl-6">
                        <span class="text-lg font-black text-[#00897b]">ä¸¦åŠ è´ˆï¼š${uniqueExtras.join('ã€')}</span>
                    </div>
                `;
            }
            totalContainer.innerHTML = totalHtml;
        }

        window.onload = addPhone;
    </script>
</body>
</html>
