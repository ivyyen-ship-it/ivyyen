<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESI AIoT 戰情中心</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- 引入 Lucide 核心庫 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc;
            margin: 0;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        /* 旋轉動畫 */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin 8s linear infinite;
        }
    </style>
</head>
<body class="overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        /**
         * 穩定版圖標元件
         * 直接使用 <i> 標籤配合 Lucide 的 UMD 引擎注入 SVG
         * 徹底解決 React #130 物件渲染錯誤問題
         */
        const Icon = ({ name, size = 18, className = "" }) => {
            const iconRef = useRef(null);
            
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons({
                        targets: [iconRef.current]
                    });
                }
            }, [name]);

            return (
                <i 
                    ref={iconRef}
                    data-lucide={name} 
                    className={className}
                    style={{ 
                        width: size, 
                        height: size, 
                        display: 'inline-block',
                        strokeWidth: 2
                    }}
                ></i>
            );
        };

        const App = () => {
            const [currentPage, setCurrentPage] = useState('center'); 
            const [searchQuery, setSearchQuery] = useState('');
            const [selectedCustomer, setSelectedCustomer] = useState(null);
            const [activeServiceTab, setActiveServiceTab] = useState('intercom');
            const [lastUpdate, setLastUpdate] = useState(new Date().toLocaleTimeString());

            // 模擬資料庫
            const mockCustomers = [
                {
                    id: 'CUST-8801',
                    name: '林大華',
                    phone: '0912345678',
                    community: '天籟之音社區',
                    address: '台北市信義區忠孝東路五段',
                    managerPhone: '02-2345-6789',
                    salesRep: '張小明',
                    services: [
                        { 
                            id: 'intercom', 
                            label: '對講機', 
                            status: 'error', 
                            health: 35,
                            warranty: { hardware: '2025/07/02~2027/07/02', line: '2025/07/02~2026/07/02' },
                            network: { sipStatus: '斷線', ip: '192.168.1.10', mac: '00:1A:2B:3C:4D:5E' }
                        },
                        { 
                            id: 'charging', 
                            label: '充電樁', 
                            status: 'online', 
                            health: 98,
                            powerBox: { location: 'B3動力箱區' },
                            parkingSpot: '064號車位'
                        }
                    ],
                    historyRecords: [
                        { id: 'T-9921', date: '2025/06/15', category: '對講機', status: '已結案', result: '更換按鈕面板' }
                    ]
                }
            ];

            const handleSearch = () => {
                const found = mockCustomers.find(c => 
                    c.phone === searchQuery.trim() || c.community.includes(searchQuery.trim())
                );
                if (found) {
                    setSelectedCustomer(found);
                    setActiveServiceTab(found.services[0].id);
                } else {
                    setSelectedCustomer(null);
                }
            };

            const activeServiceData = useMemo(() => {
                return selectedCustomer?.services.find(s => s.id === activeServiceTab);
            }, [selectedCustomer, activeServiceTab]);

            return (
                <div className="flex h-screen w-full overflow-hidden bg-slate-50 text-slate-800">
                    {/* 左側選單 */}
                    <aside className="w-20 lg:w-64 bg-slate-900 text-white flex flex-col flex-shrink-0">
                        <div className="p-6 flex items-center gap-3">
                            <div className="bg-blue-600 p-2 rounded-lg flex-shrink-0">
                                <Icon name="cpu" size={20} />
                            </div>
                            <span className="font-bold text-xl hidden lg:block tracking-tight">ESI AIoT</span>
                        </div>
                        
                        <nav className="flex-1 px-4 mt-6 space-y-2">
                            <button 
                                onClick={() => setCurrentPage('center')}
                                className={`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${currentPage === 'center' ? 'bg-blue-600' : 'text-slate-400 hover:bg-slate-800'}`}
                            >
                                <Icon name="user-search" size={20} />
                                <span className="hidden lg:block font-medium">客訴受理中心</span>
                            </button>
                            <button 
                                onClick={() => setCurrentPage('monitoring')}
                                className={`w-full flex items-center gap-3 p-3 rounded-xl transition-all ${currentPage === 'monitoring' ? 'bg-blue-600' : 'text-slate-400 hover:bg-slate-800'}`}
                            >
                                <Icon name="activity" size={20} />
                                <span className="hidden lg:block font-medium">設備告警監控</span>
                            </button>
                        </nav>
                    </aside>

                    {/* 主內容區 */}
                    <main className="flex-1 flex flex-col min-w-0 h-full overflow-hidden">
                        {currentPage === 'center' ? (
                            <div className="flex flex-col h-full">
                                {/* 搜尋列 */}
                                <header className="h-20 bg-white border-b px-8 flex items-center shadow-sm z-10 flex-shrink-0">
                                    <div className="max-w-3xl w-full mx-auto relative flex items-center">
                                        <div className="absolute left-4 text-slate-400">
                                            <Icon name="search" size={18} />
                                        </div>
                                        <input 
                                            type="text"
                                            className="w-full bg-slate-100 border-none rounded-2xl py-3 pl-12 pr-32 outline-none focus:ring-2 ring-blue-500 transition-all text-lg"
                                            placeholder="請輸入電話 0912345678 測試..."
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                            onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                                        />
                                        <button 
                                            onClick={handleSearch}
                                            className="absolute right-2 bg-blue-600 text-white px-6 py-2 rounded-xl font-bold hover:bg-blue-700"
                                        >
                                            搜尋
                                        </button>
                                    </div>
                                </header>

                                {/* 內容展示區 */}
                                <div className="flex-1 overflow-y-auto p-6 custom-scrollbar">
                                    {!selectedCustomer ? (
                                        <div className="h-full flex flex-col items-center justify-center text-slate-300">
                                            <Icon name="layout-dashboard" size={64} />
                                            <p className="mt-4 text-xl font-bold">請輸入關鍵字搜尋社區或用戶</p>
                                        </div>
                                    ) : (
                                        <div className="max-w-6xl mx-auto grid grid-cols-12 gap-6">
                                            {/* 用戶資訊卡 */}
                                            <div className="col-span-12 lg:col-span-4 space-y-6">
                                                <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                                                    <div className="bg-slate-800 p-6 text-white text-center">
                                                        <h2 className="text-xl font-bold">{selectedCustomer.community}</h2>
                                                        <p className="text-blue-400 text-xs mt-1 font-mono tracking-widest">ID: {selectedCustomer.id}</p>
                                                    </div>
                                                    <div className="p-6 space-y-4">
                                                        <div className="flex justify-between items-center border-b pb-4">
                                                            <span className="text-slate-400 text-sm">主要窗口</span>
                                                            <span className="font-bold">{selectedCustomer.name}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center border-b pb-4">
                                                            <span className="text-slate-400 text-sm">聯繫電話</span>
                                                            <span className="font-bold">{selectedCustomer.phone}</span>
                                                        </div>
                                                        <div className="flex justify-between items-center">
                                                            <span className="text-slate-400 text-sm">負責業務</span>
                                                            <span className="font-bold text-blue-600">{selectedCustomer.salesRep}</span>
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="bg-white rounded-3xl p-4 shadow-sm border border-slate-200">
                                                    <p className="text-xs font-bold text-slate-400 mb-3 px-2 uppercase tracking-widest">服務清單</p>
                                                    <div className="space-y-2">
                                                        {selectedCustomer.services.map(svc => (
                                                            <button 
                                                                key={svc.id}
                                                                onClick={() => setActiveServiceTab(svc.id)}
                                                                className={`w-full flex items-center justify-between p-4 rounded-2xl transition-all ${activeServiceTab === svc.id ? 'bg-blue-600 text-white shadow-lg shadow-blue-200' : 'hover:bg-slate-100 text-slate-600'}`}
                                                            >
                                                                <span className="font-bold">{svc.label}</span>
                                                                <div className={`w-2 h-2 rounded-full ${svc.status === 'online' ? 'bg-emerald-400' : 'bg-red-500 animate-pulse'}`}></div>
                                                            </button>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>

                                            {/* 技術詳情卡 */}
                                            <div className="col-span-12 lg:col-span-8 space-y-6">
                                                <div className="bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden">
                                                    <div className="p-6 bg-slate-50 border-b flex justify-between items-center">
                                                        <h3 className="font-bold flex items-center gap-2">
                                                            <Icon name="settings-2" size={18} className="text-blue-600" />
                                                            {activeServiceData?.label} 技術參數診斷
                                                        </h3>
                                                        <span className={`px-3 py-1 rounded-full text-xs font-bold ${activeServiceData?.health > 80 ? 'bg-emerald-100 text-emerald-600' : 'bg-red-100 text-red-600'}`}>
                                                            健康度: {activeServiceData?.health}%
                                                        </span>
                                                    </div>
                                                    <div className="p-8">
                                                        {activeServiceTab === 'intercom' && (
                                                            <div className="space-y-6">
                                                                <div className="grid grid-cols-2 gap-4">
                                                                    <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                                                                        <p className="text-xs text-slate-400 font-bold mb-1">硬體保固</p>
                                                                        <p className="font-bold">{activeServiceData.warranty.hardware}</p>
                                                                    </div>
                                                                    <div className="bg-slate-50 p-4 rounded-2xl border border-slate-100 text-center">
                                                                        <p className="text-xs text-slate-400 font-bold mb-1">線路保固</p>
                                                                        <p className="font-bold">{activeServiceData.warranty.line}</p>
                                                                    </div>
                                                                </div>
                                                                <div className="bg-slate-900 rounded-2xl p-6 text-white border-l-4 border-blue-500 shadow-xl">
                                                                    <div className="flex justify-between items-center mb-4">
                                                                        <span className="text-xs font-bold text-blue-400">NETWORK MONITOR</span>
                                                                        <span className={`text-xs font-bold ${activeServiceData.network.sipStatus === '斷線' ? 'text-red-400' : 'text-emerald-400'}`}>
                                                                            {activeServiceData.network.sipStatus}
                                                                        </span>
                                                                    </div>
                                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs font-mono opacity-80">
                                                                        <p>MAC: {activeServiceData.network.mac}</p>
                                                                        <p>IP: {activeServiceData.network.ip}</p>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        )}
                                                        {activeServiceTab === 'charging' && (
                                                            <div className="p-10 text-center border-2 border-dashed border-slate-100 rounded-3xl">
                                                                <Icon name="battery-charging" size={48} className="mx-auto text-blue-200 mb-4" />
                                                                <p className="font-bold text-slate-600">動力箱位置: {activeServiceData.powerBox.location}</p>
                                                                <p className="text-sm text-slate-400 mt-2">對應車位: {activeServiceData.parkingSpot}</p>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        ) : (
                            /* 全球監控頁面 */
                            <div className="flex-1 flex flex-col bg-slate-950 text-slate-200 overflow-hidden">
                                <header className="h-16 border-b border-slate-800 px-8 flex items-center justify-between">
                                    <div className="flex items-center gap-3">
                                        <div className="w-2 h-2 bg-red-500 rounded-full animate-pulse shadow-[0_0_8px_rgba(239,68,68,0.8)]"></div>
                                        <h2 className="font-black italic tracking-tighter">AIoT LIVE DASHBOARD</h2>
                                    </div>
                                    <span className="text-xs font-mono opacity-50">{lastUpdate}</span>
                                </header>
                                <div className="flex-1 p-8 overflow-y-auto custom-scrollbar">
                                    <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                                        {[
                                            { label: '異常社區', val: '12', color: 'text-red-500' },
                                            { label: '設備離線', val: '158', color: 'text-orange-500' },
                                            { label: '待辦工單', val: '24', color: 'text-blue-500' },
                                            { label: '平均修復時效', val: '4.2h', color: 'text-emerald-500' }
                                        ].map((item, i) => (
                                            <div key={i} className="bg-slate-900/50 border border-slate-800 p-6 rounded-3xl hover:border-slate-700 transition-all">
                                                <p className="text-[10px] font-bold text-slate-500 uppercase tracking-widest">{item.label}</p>
                                                <p className={`text-4xl font-black mt-2 ${item.color}`}>{item.val}</p>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="bg-slate-900/50 border border-slate-800 rounded-3xl p-20 flex flex-col items-center justify-center">
                                        <Icon name="refresh-cw" size={48} className="text-blue-500 animate-spin-slow mb-4" />
                                        <p className="text-sm font-mono opacity-30">ENCRYPTED DATA STREAM CONNECTED...</p>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
